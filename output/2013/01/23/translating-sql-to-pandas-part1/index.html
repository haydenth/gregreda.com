<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>Greg Reda | Translating SQL to Pandas, Part 1</title>
	<meta name="google-site-verification" content="AgIAQN_qsniIQWOq659Bnhzx-LZts2FdgP1kLgtQg-k" />
	<meta name="description" content="">
	<meta name="author" content="Greg Reda">

	<!-- Facebook Open Graph
  ================================================== -->
  <meta property="og:title" content="Greg Reda: Data geek in Chicago.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://www.gregreda.com">
  <meta property="og:image" content="http://www.gregreda.com/theme/images/avatar.jpg">
  <meta property="og:description" content="Greg Reda is a Chicagoan focused on analyzing data to provide insight and drive decisions. He also loves stats, visualization, beer, and music.">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="../../../../theme/css/base.css">
	<link rel="stylesheet" href="../../../../theme/css/skeleton.css">
	<link rel="stylesheet" href="../../../../theme/css/layout.css">
	<link rel="stylesheet" href="../../../../theme/css/simply.css">
	<link rel="stylesheet" href="../../../../theme/css/pygments.css">
	<link rel="stylesheet" href="../../../../theme/css/font-awesome.css">
	<link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- JavaScript
	=================================================== -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<!-- <script type="text/javascript">
	  function trackOutboundLink(link, category, action) {
	    try { 
	      _gaq.push(['_trackEvent', category , action]); 
	    } catch(err){}
	   
	    setTimeout(function() { document.location.href = link.href; }, 100);
	  }
	</script> -->

	<!-- Favicons
	================================================== -->
	<!-- <link rel="shortcut icon" href="./theme/images/favicon.ico"> -->
	<link rel="apple-touch-icon" href="./theme/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="./theme/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="./theme/images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->
	<div class="container">
		<div id="sidebar" class="three columns">
			<a href="../../../.."><img id="avatar" src="../../../../theme/images/avatar.jpg"></img></a>
			<h3 id="logo"><a href="../../../..">Greg Reda</a></h3>
	    <p id="bio">Hi. I'm a data analyst at <a href="http://grubhub.com">GrubHub</a> in Chicago. I'm obsessed with all things data, statistics, music, and craft beer.</p>
	    <!-- <br />
	    <p>I analyze data in order to solve problems and provide some useful insights. If you have some curiosities and some data, you should send me an email.</p> -->
	    <hr class="small" /> 
    	<div id="social">
    		<a class="icon" href="https://twitter.com/gjreda" title="Twitter"><i class="icon-twitter"></i></a>
    		<a class="icon" href="https://github.com/gjreda" title="GitHub"><i class="icon-github"></i></a>
    		<a class="icon" href="http://linkedin.com/in/gjreda" title="LinkedIn"><i class="icon-linkedin"></i></a>
				<a class="icon" href="https://last.fm/user/gjreda" title="LastFM"><i class="icon-music"></i></a>
    		<a class="icon" href="mailto:gjreda@gmail.com?subject=Hi" title="E-Mail"><i class="icon-envelope"></i></a>
    		<a class="icon" href="http://www.gregreda.com/feeds/all.atom.xml" title="Subscribe (Atom)"><i class="icon-rss"></i></a>
    	</div> <!-- social -->
    	<!-- <a style="text-align:center;" href="../../../../about/">About Me</a> -->
		</div> <!-- sidebar -->

		<section id="content" class="twelve columns offset-by-one">
			
  <h3 class="article-title"><a href="/2013/01/23/translating-sql-to-pandas-part1" title="Permalink to Translating SQL to Pandas, Part 1">Translating SQL to Pandas, Part 1</a></h3>
  <h6 class="article-date">January 23, 2013</h6>
  <div class="article-content">
    <p>For some reason, I've always found SQL to a much more intuitive tool for exploring a tabular dataset than I have other languages (namely R and Python).</p>
<p>If you know SQL well, you can do a whole lot with it, and since data is often in a relational database anyway, it usually makes sense to stick with it.  I find that my workflow often includes writing a lot of queries in SQL (using <a href="http://www.sequelpro.com/">Sequel Pro</a>) to get the data the way I want it, reading it into R (with <a href="http://www.rstudio.com/">RStudio</a>), and then maybe a bit more exploration, modeling, and visualization (with <a href="http://ggplot2.org/">ggplot2</a>).</p>
<p>Not too long ago though, I came across <a href="http://blog.wesmckinney.com/">Wes McKinney</a>'s <a href="http://pandas.pydata.org">pandas</a> package and my interest was immediately piqued.  Pandas adds a bunch of functionality to Python, but most importantly, it allows for a DataFrame data structure - much like a database table or R's data frame.</p>
<p>Given the great things I've been reading about pandas lately, I wanted to make a conscious effort to play around with it.  Instead of my typical workflow being a couple disjointed steps with SQL + R + (sometimes) Python, my thought is that it might make sense to have pandas work its way in and take over the R work.  While I probably won't be able to completely give up R (too much ggplot2 love over here), I get bored if I'm not learning something new, so pandas it is.</p>
<p>I intend to document the process a bit - hopefully a couple posts illustrating the differences between SQL and pandas (and maybe some R too).</p>
<p>Throughout the rest of this post, we're going to be working with data from the <a href="https://data.cityofchicago.org">City of Chicago's open data</a> - specifically the <a href="https://data.cityofchicago.org/Transportation/Towed-Vehicles/ygr5-vcbg">Towed Vechicles data</a>.</p>
<h4>Loading the data</h4>
<h5>Using SQLite</h5>
<p>To be able to use SQL with this dataset, we'd first have to create the table.  Using <a href="http://www.sqlite.org/">SQLite</a> syntax, we'd run the following:</p>
<div class="codehilite"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">towed</span> <span class="p">(</span>
    <span class="n">tow_date</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">make</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">style</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">model</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">color</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">plate</span> <span class="nb">text</span><span class="p">,</span>
    <span class="k">state</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">towed_address</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">phone</span> <span class="nb">text</span><span class="p">,</span>
    <span class="n">inventory</span> <span class="nb">text</span>
<span class="p">);</span>
</pre></div>


<p>Because SQLite <a href="http://www.sqlite.org/datatype3.html">uses a very generic type system</a>, we don't get the strict data types that we would in most other databases (such as MySQL and PostgreSQL); therefore, all of our data is going to be stored as text.  In other databases, we'd store tow_date as a date or datetime field.</p>
<p>Before we read the data into SQLite, we need to tell the database to that the fields are separated by a comma.  Then we can use the import command to read the file into our table.</p>
<div class="codehilite"><pre><span class="p">.</span><span class="n">separator</span> <span class="s1">&#39;,&#39;</span>
<span class="p">.</span><span class="n">import</span> <span class="p">.</span><span class="o">/</span><span class="n">Towed_Vehicles</span><span class="p">.</span><span class="n">csv</span> <span class="n">towed</span>
</pre></div>


<p>Note that the downloaded CSV contains two header rows, so we'll need to delete those from our table since we don't need them.</p>
<div class="codehilite"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">towed</span> <span class="k">WHERE</span> <span class="n">tow_date</span> <span class="o">=</span> <span class="s1">&#39;Tow Date&#39;</span><span class="p">;</span>
</pre></div>


<p>We should have 5,068 records in our table now (note: the City of Chicago regularly updates this dataset, so you might get a different number).</p>
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">towed</span><span class="p">;</span> <span class="c1">-- 5068</span>
</pre></div>


<h5>Using Python + pandas</h5>
<p>Let do the same with <a href="http://pandas.pydata.org">pandas</a> now.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;tow_date&quot;</span><span class="p">,</span> <span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;model&quot;</span><span class="p">,</span> <span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="s">&quot;plate&quot;</span><span class="p">,</span> <span class="s">&quot;state&quot;</span><span class="p">,</span>
    <span class="s">&quot;towed_address&quot;</span><span class="p">,</span> <span class="s">&quot;phone&quot;</span><span class="p">,</span> <span class="s">&quot;inventory&quot;</span><span class="p">]</span>
<span class="n">towed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&quot;Towed_Vehicles.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">col_names</span><span class="p">,</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;tow_date&quot;</span><span class="p">])</span>
</pre></div>


<p>The read_csv function in pandas actually allowed us to skip the two header columns and translate the tow_date field to a datetime field.</p>
<p>Let's check our count just to make sure.</p>
<div class="codehilite"><pre><span class="nb">len</span><span class="p">(</span><span class="n">towed</span><span class="p">)</span> <span class="c"># 5068</span>
</pre></div>


<h4>Selecting data</h4>
<h5>SQL</h5>
<p>Selection data with SQL is fairly intuitive - just SELECT the columns you want FROM the particular table you're interested in.  You can also take advantage of the LIMIT clause to only see a subset of your data.</p>
<div class="codehilite"><pre><span class="c1">-- Return every column for every record in the towed table</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">towed</span><span class="p">;</span>

<span class="c1">-- Return the tow_date, make, style, model, and color for every record in the towed table</span>
<span class="k">SELECT</span> <span class="n">tow_date</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">color</span> <span class="k">FROM</span> <span class="n">towed</span><span class="p">;</span>

<span class="c1">-- Return every column for the first five records of the towed table</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">towed</span> <span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>

<span class="c1">-- Return every column in the towed table - start at the fifth record and show the next ten</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">towed</span> <span class="k">LIMIT</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">-- records 5-14</span>
</pre></div>


<p>Additionally, you can throw a WHERE or ORDER BY (or both) into your queries for proper filtering and ordering of the data returned:</p>
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">towed</span> <span class="k">WHERE</span> <span class="k">state</span> <span class="o">=</span> <span class="s1">&#39;TX&#39;</span><span class="p">;</span> <span class="c1">-- Only towed vehicles from Texas</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">towed</span> <span class="k">WHERE</span> <span class="n">make</span> <span class="o">=</span> <span class="s1">&#39;KIA&#39;</span> <span class="k">AND</span> <span class="k">state</span> <span class="o">=</span> <span class="s1">&#39;TX&#39;</span><span class="p">;</span> <span class="c1">-- KIAs with Texas plates</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">towed</span> <span class="k">WHERE</span> <span class="n">make</span> <span class="o">=</span> <span class="s1">&#39;KIA&#39;</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">color</span><span class="p">;</span> <span class="c1">-- All KIAs ordered by color (A to Z)</span>
</pre></div>


<h5>Python + pandas</h5>
<p>Let's do some of the same, but this time let's use pandas:</p>
<div class="codehilite"><pre><span class="c"># show only the make column for all records</span>
<span class="n">towed</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">]</span>

<span class="c"># tow_date, make, style, model, and color for the first ten records</span>
<span class="n">towed</span><span class="p">[[</span><span class="s">&quot;tow_date&quot;</span><span class="p">,</span> <span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;model&quot;</span><span class="p">,</span> <span class="s">&quot;color&quot;</span><span class="p">]][:</span><span class="mi">10</span><span class="p">]</span>

<span class="n">towed</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="c"># first five rows (alternatively, you could use towed.head())</span>
</pre></div>


<p>Because pandas is built on top of <a href="http://www.numpy.org/">NumPy</a>, we're able to use <a href="http://pandas.pydata.org/pandas-docs/dev/indexing.html#boolean-indexing">boolean indexing</a>.  Since we're going to replicate similar statements to the ones we did in SQL, we know we're going to need towed cars from TX made by KIA.</p>
<div class="codehilite"><pre><span class="n">towed</span><span class="p">[</span><span class="n">towed</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;TX&quot;</span><span class="p">]</span> <span class="c"># all columns and records where the car was from TX</span>

<span class="n">towed</span><span class="p">[(</span><span class="n">towed</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;TX&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">towed</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;KIA&quot;</span><span class="p">)]</span> <span class="c"># made by KIA AND from TX</span>

<span class="n">towed</span><span class="p">[(</span><span class="n">towed</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;MA&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">towed</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;JAGU&quot;</span><span class="p">)]</span> <span class="c"># made by Jaguar OR from MA</span>

<span class="n">towed</span><span class="p">[</span><span class="n">towed</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;KIA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">)</span> <span class="c"># made by KIA, ordered by color (A to Z)</span>
</pre></div>


<h5>Conclusion, Part 1</h5>
<p>This was obviously a very basic start, but there are a lot of good things about pandas - it's certainly concise and readable.  Plus, since it works well with the various science + math packages (<a href="http://www.scipy.org">SciPy</a>, <a href="http://www.numpy.org/">NumPy</a>, <a href="http://matplotlib.org/">Matplotlib</a>, <a href="http://statsmodels.sourceforge.net/">statsmodels</a>, etc.), there's the potential to work almost entirely in one language for analysis tasks.</p>
<p>I plan on covering aggregate functions, pivots, and maybe some matplotlib in my next post.</p>
  </div>
    

    
    <a href="https://twitter.com/gjreda" class="twitter-follow-button" data-show-count="false">Follow @gjreda</a>
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="gjreda" data-count="none">Tweet</a>
    <div class="back-to-home"><a href="../../../..">‚Üê Back to Home</a></div>
    <hr class="large">
    
    <!-- DISQUS -->
          <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'gregreda'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
<!-- twitter.js -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
		</section>

		<footer class="twelve columns offset-by-one">
			<!-- <hr class="small"> -->
			<p>Generated with <a href="http://getpelican.com">Pelican</a>. Layout done with <a href="http://getskeleton.com">Skeleton</a>. Icons are <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>. Hosted on <a href="http://aws.amazon.com/s3/">S3</a>.
		</footer>
		
	</div><!-- container -->

<!-- Google Analytics -->
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34295039-1']);
  _gaq.push(['_setDomainName', 'gregreda.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

	<!-- <script type="text/javascript">
		$(document).ready(function() {
			$("a").click(function() {
				trackOutboundLink(this, "Outbound Links", this.href.toString());
				return false;
			})
		})
	</script> -->

<!-- End Document
================================================== -->
</body>
</html>